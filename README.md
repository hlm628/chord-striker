# Chord Striker

![The beginning of a song generated by Chord Striker](assets/ex_chord_chart.png)

A Python library for generating random harmonic song structures. The results are formatted into PDF chord charts by Lilypond, and supplied with an accompanying MIDI file. If you're stuck in a creative rut, this can be an excellent way to start writing a new song! I like to load the MIDI file into a DAW and start building on top of it.

Example outputs can be seen in the [example directory](./example).


## Features

- Generate random chord progressions with musical coherence
- Create full song structures with intros, verses, pre-choruses, choruses, and so on
- Add realistic variations to chord progressions
- Export to PDF chord charts using Lilypond
- Generate accompanying MIDI files
- Cross-platform support via Docker
- Create full albums of songs

## How It Works

Chord Striker uses probability and music theory to generate song structures. 

- First, a section layout is generated. This works by sampling from a probabilistic directed acyclic graph (DAG) that models common song transitions. The details can be found in `chord_striker/probabilistic_dag.py` and `chord_striker/song_structure.py`. An example of a generated song structure graph can be seen in [example/song_structure_graph.png](./example/song_structure_graph.png).
- Then each section is populated with chord progressions. These are generated in one of two ways: either by sampling from a list of pre-defined "famous" chord progressions, or from a Markov chain that models how chords transition between one another. The details can be found in `chord_striker/chorder.py`. Repetitions of sections may have small variations (e.g. a chord change, an added chord, or a different length).
- Finally, the resulting song structure is exported to Lilypond, which converts it into a PDF chord chart and accompanying MIDI file.

There are a number of parameters that can be modified to change the sound of the generated songs. These are stored in YAML files in the `constants` directory. The package will first look for custom parameters in the subdirectory`constants/user`, falling back to the defaults in `constants/defaults` if none are found. You can also specify a custom directory of parameters when calling the functions directly. Experimenting with these is a good way to impart your own style into the generated songs.

## Installation

### Using Docker (Recommended)

The easiest way to get started is using Docker:

```bash
# Build the Docker image
make docker

# Enter the container
make enter
```

### Manual Installation

1. Install Python 3.11 or later
2. Install Lilypond (version 2.22.1 or later)
3. Install the Python dependencies:
   ```bash
   pip install -r docker/requirements.txt
   ```

## Usage

### Basic Usage

Generate a single song:
```bash
make run-song
```

Generate a song with specific parameters:
```bash
make run-song SONG_NAME="My Song" SEED=42 TEMPO=120 KEY=D
```

Generate multiple songs (default: 10):
```bash
make run-album
```



### Output

The generated files will be placed in the `example` directory by default. Each song generation creates:
- A PDF chord chart
- A MIDI file
- A Lilypond source file
- An auxiliary file for Lilypond containing the chord symbols

### Customisation

You can customise the output of `make run-song` with the following options:
- `SONG_NAME`: Name of the generated song
- `SEED`: Random seed for reproducible results
- `OUTPUT_DIR`: Directory for generated files
- `ALBUM_TRACKS`: Number of songs to generate (for `run-album`)
- `PRINT_GRAPH`: Whether to print the song structure graph
- `CONSTANTS_DIR`: Directory containing custom YAML parameter files

`CONSTANTS_DIR` should be a subdirectory of `constants`, and should contain the same files and schema as the `constants/defaults` directory:
- `structure_params.yaml`: Song structure probabilities
- `chord_change_probs.yaml`: Chord transition probabilities
- `key_probs.yaml`: Key probabilities
- `chord_extensions.yaml`: Chord extension probabilities
- `famous_chord_progressions.yaml`: Pre-defined chord progressions



## Development

### Project Structure

```
chord-striker/
├── chord_striker/     # Main Python package
├── docker/           # Docker configuration
├── example/          # Generated output
├── assets/           # Static assets
├── tests/            # Test suite
└── constants/        # Musical constants
    ├── defaults/     # Default parameters
    └── user/         # Custom parameters (git-ignored)
```

### Running Tests

```bash
make test
```

### Building for All Platforms

To build Docker images for both ARM64 and AMD64:

```bash
make docker-all
```

Note: This requires a Docker registry for pushing the images.

## License

This project is licensed under the GNU General Public License v3.0 - see the [LICENSE](LICENSE) file for details.

## Contributing

Contributions are welcome! Please make changes to a fork and open a pull request. Run `make test` to ensure your changes are compatible with the existing code.

### Questions?

Feel free to open an issue for any questions or suggestions!

